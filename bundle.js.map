{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/sketch.js","webpack:///./src/oflow/webcamFlow.js","webpack:///./src/index.js","webpack:///./node_modules/stats-js/build/stats.min.js","webpack:///./src/oflow/videoFlow.js","webpack:///./src/oflow/flowCalculator.js","webpack:///./src/oflow/flowZone.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","root","window","this","document","MATH_PROPS","split","M","Math","CANVAS","DOM","doc","win","instances","defaults","fullscreen","autostart","autoclear","autopause","container","body","interval","globals","retina","type","keyMap","8","9","13","16","27","32","37","38","39","40","isFunction","isString","extend","target","source","overwrite","proxy","method","context","apply","arguments","constructor","request","handler","parent","bounds","index","suffix","clock","node","copy","val","min","max","w","h","counter","touches","resized","mouseMoved","setup","ratio","devicePixelRatio","isDiv","is2D","mouse","x","y","ox","oy","dx","dy","eventMap","eventTarget","element","pointer","event","code","keyCode","keys","String","fromCharCode","trigger","stop","start","resize","splice","on","length","passive","capture","style","canvas","width","height","innerHeight","innerWidth","scale","augment","touch","getBoundingClientRect","pageX","left","scrollX","pageXOffset","pageY","top","scrollY","pageYOffset","align","process","currentTarget","preventDefault","clone","originalEvent","indexOf","dragging","test","now","Date","running","millis","NaN","dt","destroy","parentNode","removeChild","toggle","clear","clearRect","push","update","cAF","rAF","save","draw","restore","Sketch","WEB_GL","WEBGL","install","TWO_PI","PI","HALF_PI","QUARTER_PI","random","toString","isNumber","lerp","amount","map","num","minA","maxA","minB","maxB","options","self","createElement","getContext","appendChild","className","vendors","scope","then","a","b","callback","id","setTimeout","clearTimeout","factory","VideoFlow","require","defaultVideoTag","zoneSize","cameraFacing","videoOptions","videoTag","isCapturing","localStream","videoFlow","calculatedCallbacks","onWebCamFail","e","gotFlow","direction","forEach","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","startCapture","setAttribute","MediaStreamTrack","getSources","sourceInfos","kind","selectedVideoSource","facing","desiredDevice","optional","sourceId","video","stream","srcObject","onCalculated","mediaDevices","enumerateDevices","deviceId","initCapture","stopCapture","pause","__webpack_exports__","_sketch__WEBPACK_IMPORTED_MODULE_0__","_sketch__WEBPACK_IMPORTED_MODULE_0___default","_oflow_webcamFlow__WEBPACK_IMPORTED_MODULE_2__","_oflow_webcamFlow__WEBPACK_IMPORTED_MODULE_2___default","sketch","position","backgroundColor","ctx","particleSystem","positions","velocities","numParticles","webcamFlow","flow","world","sqr","dist2","v","distToSegmentSquared","l2","gravity","b2Vec2","b2World","bd","b2BodyDef","b2_staticBody","CreateBody","b1","b2PolygonShape","SetAsBoxXYCenterAngle","CreateFixtureFromShape","b2","b3","b4","psd","b2ParticleSystemDef","radius","dampingStrength","surfaceTensionNormalStrength","surfaceTensionPressureStrength","CreateParticleSystem","box","particleGroupDef","b2ParticleGroupDef","shape","flags","b2_tensileParticle","CreateParticleGroup","GetPositionBuffer","GetVelocityBuffer","WebCamFlow","ideal","m1","m2","pos","fx","round","numX","fy","numY","u","uvArray","Step","dpr","setTransform","fillStyle","g","vx","vy","sqrt","ix","floor","iy","address","lum","image","rgv","pow","bv","rad","beginPath","arc","fill","touchstart","dom","children","display","cssText","addEventListener","performance","f","Panel","memory","REVISION","addPanel","showPanel","begin","end","usedJSHeapSize","jsHeapSizeLimit","domElement","setMode","font","textBaseline","fillRect","fillText","globalAlpha","drawImage","FlowCalculator","oldImage","loopId","calculator","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","cancelAnimFrame","cancelAnimationFrame","mozCancelAnimationFrame","calculate","newImage","videoWidth","videoHeight","imgd","getImageData","data","getCurrentPixels","zones","animloop","err","Error","message","initView","getWidth","getHeight","step","A2","A1B2","B1","C1","C2","uu","vv","winStep","globalY","globalX","localY","localX","wMax","hMax","ceil","numElements","Float32Array","gradX","gradY","gradT","delta","Idelta","norm","temp"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","\n/* Copyright (C) 2013 Justin Windle, http://soulwire.co.uk */\n\n(function ( root, factory ) {\n\n  if ( typeof exports === 'object' ) {\n\n    // CommonJS like\n    module.exports = factory(root, root.document);\n\n  } else if ( typeof define === 'function' && define.amd ) {\n\n    // AMD\n    define( function() { return factory( root, root.document ); });\n\n  } else {\n\n    // Browser global\n    root.Sketch = factory( root, root.document );\n  }\n\n}( typeof window !== \"undefined\" ? window : this, function ( window, document ) {\n\n\n  \"use strict\";\n\n  /*\n  ----------------------------------------------------------------------\n\n    Config\n\n  ----------------------------------------------------------------------\n  */\n\n  var MATH_PROPS = 'E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min'.split( ' ' );\n  var HAS_SKETCH = '__hasSketch';\n  var M = Math;\n\n  var CANVAS = 'canvas';\n  var WEBGL = 'webgl';\n  var DOM = 'dom';\n\n  var doc = document;\n  var win = window;\n\n  var instances = [];\n\n  var defaults = {\n\n    fullscreen: true,\n    autostart: true,\n    autoclear: true,\n    autopause: true,\n    container: doc.body,\n    interval: 1,\n    globals: true,\n    retina: false,\n    type: CANVAS\n  };\n\n  var keyMap = {\n\n     8: 'BACKSPACE',\n     9: 'TAB',\n    13: 'ENTER',\n    16: 'SHIFT',\n    27: 'ESCAPE',\n    32: 'SPACE',\n    37: 'LEFT',\n    38: 'UP',\n    39: 'RIGHT',\n    40: 'DOWN'\n  };\n\n  /*\n  ----------------------------------------------------------------------\n\n    Utilities\n\n  ----------------------------------------------------------------------\n  */\n\n  function isArray( object ) {\n\n    return Object.prototype.toString.call( object ) == '[object Array]';\n  }\n\n  function isFunction( object ) {\n\n    return typeof object == 'function';\n  }\n\n  function isNumber( object ) {\n\n    return typeof object == 'number';\n  }\n\n  function isString( object ) {\n\n    return typeof object == 'string';\n  }\n\n  function keyName( code ) {\n\n    return keyMap[ code ] || String.fromCharCode( code );\n  }\n\n  function extend( target, source, overwrite ) {\n\n    for ( var key in source )\n\n      if ( overwrite || !( key in target ) )\n\n        target[ key ] = source[ key ];\n\n    return target;\n  }\n\n  function proxy( method, context ) {\n\n    return function() {\n\n      method.apply( context, arguments );\n    };\n  }\n\n  function clone( target ) {\n\n    var object = {};\n\n    for ( var key in target ) {\n      \n      if ( key === 'webkitMovementX' || key === 'webkitMovementY' )\n        continue;\n\n      if ( isFunction( target[ key ] ) )\n\n        object[ key ] = proxy( target[ key ], target );\n\n      else\n\n        object[ key ] = target[ key ];\n    }\n\n    return object;\n  }\n\n  /*\n  ----------------------------------------------------------------------\n\n    Constructor\n\n  ----------------------------------------------------------------------\n  */\n\n  function constructor( context ) {\n\n    var request, handler, target, parent, bounds, index, suffix, clock, node, copy, type, key, val, min, max, w, h;\n\n    var counter = 0;\n    var touches = [];\n    var resized = false;\n    var mouseMoved = false;\n    var setup = false;\n    var ratio = win.devicePixelRatio || 1;\n    var isDiv = context.type == DOM;\n    var is2D = context.type == CANVAS;\n\n    var mouse = {\n      x:  0.0, y:  0.0,\n      ox: 0.0, oy: 0.0,\n      dx: 0.0, dy: 0.0\n    };\n\n    var eventMap = [\n\n      context.eventTarget || context.element,\n\n        pointer, 'mousedown', 'touchstart',\n        pointer, 'mousemove', 'touchmove',\n        pointer, 'mouseup', 'touchend',\n        pointer, 'click',\n        pointer, 'mouseout',\n        pointer, 'mouseover',\n\n      doc,\n\n        keypress, 'keydown', 'keyup',\n\n      win,\n\n        active, 'focus', 'blur',\n        resize, 'resize'\n    ];\n\n    var keys = {}; for ( key in keyMap ) keys[ keyMap[ key ] ] = false;\n\n    function trigger( method ) {\n\n      if ( isFunction( method ) )\n\n        method.apply( context, [].splice.call( arguments, 1 ) );\n    }\n\n    function bind( on ) {\n\n      for ( index = 0; index < eventMap.length; index++ ) {\n\n        node = eventMap[ index ];\n\n        if ( isString( node ) )\n\n        target[ ( on ? 'add' : 'remove' ) + 'EventListener' ].call( target, node, handler, {\n          passive: false,\n          capture: false,\n        });\n\n        else if ( isFunction( node ) )\n\n          handler = node;\n\n        else target = node;\n      }\n    }\n\n    function update() {\n\n      cAF( request );\n      request = rAF( update );\n\n      if ( !setup ) {\n\n        trigger( context.setup );\n        setup = isFunction( context.setup );\n      }\n\n      if ( !resized ) {\n        trigger( context.resize );\n        resized = isFunction( context.resize );\n      }\n\n      if ( !mouseMoved ) {\n        mouse.dx = mouse.dy = 0;\n        mouse.ox = mouse.x;\n        mouse.oy = mouse.y;\n      }\n      mouseMoved = false;\n\n      if ( context.running && !counter ) {\n\n        context.dt = ( clock = +new Date() ) - context.now;\n        context.millis += context.dt;\n        context.now = clock;\n\n        trigger( context.update );\n\n        // Pre draw\n\n        if ( is2D ) {\n\n          if ( context.retina ) {\n\n            context.save();\n            \n            if (context.autoclear) {\n              context.scale( ratio, ratio );\n            }\n          }\n\n          if ( context.autoclear )\n\n            context.clear();\n        }\n\n        // Draw\n\n        trigger( context.draw );\n\n        // Post draw\n\n        if ( is2D && context.retina )\n\n          context.restore();\n      }\n\n      counter = ++counter % context.interval;\n    }\n\n    function resize() {\n\n      target = isDiv ? context.style : context.canvas;\n      suffix = isDiv ? 'px' : '';\n\n      w = context.width;\n      h = context.height;\n\n      if ( context.fullscreen ) {\n\n        h = context.height = win.innerHeight;\n        w = context.width = win.innerWidth;\n      }\n\n      if ( context.retina && is2D && ratio ) {\n\n        target.style.height = h + 'px';\n        target.style.width = w + 'px';\n\n        w *= ratio;\n        h *= ratio;\n      }\n\n      if ( target.height !== h )\n\n        target.height = h + suffix;\n\n      if ( target.width !== w )\n\n        target.width = w + suffix;\n\n      if ( is2D && !context.autoclear && context.retina )\n\n        context.scale( ratio, ratio );\n\n      if ( setup ) trigger( context.resize );\n    }\n\n    function align( touch, target ) {\n\n      bounds = target.getBoundingClientRect();\n\n      touch.x = touch.pageX - bounds.left - (win.scrollX || win.pageXOffset);\n      touch.y = touch.pageY - bounds.top - (win.scrollY || win.pageYOffset);\n\n      return touch;\n    }\n\n    function augment( touch, target ) {\n\n      align( touch, context.element );\n\n      target = target || {};\n\n      target.ox = target.x || touch.x;\n      target.oy = target.y || touch.y;\n\n      target.x = touch.x;\n      target.y = touch.y;\n\n      target.dx = target.x - target.ox;\n      target.dy = target.y - target.oy;\n\n      return target;\n    }\n\n    function process( event ) {\n\n      if ( event.currentTarget === context.element )\n\n        event.preventDefault();\n\n      copy = clone( event );\n      copy.originalEvent = event;\n\n      if ( copy.touches ) {\n\n        touches.length = copy.touches.length;\n\n        for ( index = 0; index < copy.touches.length; index++ )\n\n          touches[ index ] = augment( copy.touches[ index ], touches[ index ] );\n\n      } else {\n\n        touches.length = 0;\n        touches[0] = augment( copy, mouse );\n      }\n\n      extend( mouse, touches[0], true );\n\n      return copy;\n    }\n\n    function pointer( event ) {\n\n      mouseMoved = true;\n\n      event = process( event );\n\n      min = ( max = eventMap.indexOf( type = event.type ) ) - 1;\n\n      context.dragging =\n\n        /down|start/.test( type ) ? true :\n\n        /up|end/.test( type ) ? false :\n\n        context.dragging;\n\n      while( min )\n\n        isString( eventMap[ min ] ) ?\n\n          trigger( context[ eventMap[ min-- ] ], event ) :\n\n        isString( eventMap[ max ] ) ?\n\n          trigger( context[ eventMap[ max++ ] ], event ) :\n\n        min = 0;\n    }\n\n    function keypress( event ) {\n\n      key = event.keyCode;\n      val = event.type == 'keyup';\n      keys[ key ] = keys[ keyName( key ) ] = !val;\n\n      trigger( context[ event.type ], event );\n    }\n\n    function active( event ) {\n\n      if ( context.autopause )\n\n        ( event.type == 'blur' ? stop : start )();\n\n      trigger( context[ event.type ], event );\n    }\n\n    // Public API\n\n    function start() {\n\n      context.now = +new Date();\n      context.running = true;\n    }\n\n    function stop() {\n\n      context.running = false;\n    }\n\n    function toggle() {\n\n      ( context.running ? stop : start )();\n    }\n\n    function clear() {\n\n      if ( is2D )\n\n        context.clearRect( 0, 0, context.width * ratio, context.height * ratio );\n    }\n\n    function destroy() {\n\n      parent = context.element.parentNode;\n      index = instances.indexOf( context );\n\n      if ( parent ) parent.removeChild( context.element );\n      if ( ~index ) instances.splice( index, 1 );\n\n      bind( false );\n      stop();\n    }\n\n    extend( context, {\n\n      touches: touches,\n      mouse: mouse,\n      keys: keys,\n\n      dragging: false,\n      running: false,\n      millis: 0,\n      now: NaN,\n      dt: NaN,\n\n      destroy: destroy,\n      toggle: toggle,\n      clear: clear,\n      start: start,\n      stop: stop\n    });\n\n    instances.push( context );\n\n    return ( context.autostart && start(), bind( true ), resize(), update(), context );\n  }\n\n  /*\n  ----------------------------------------------------------------------\n\n    Global API\n\n  ----------------------------------------------------------------------\n  */\n\n  var element, context, Sketch = {\n\n    CANVAS: CANVAS,\n    WEB_GL: WEBGL,\n    WEBGL: WEBGL,\n    DOM: DOM,\n\n    instances: instances,\n\n    install: function( context ) {\n\n      if ( !context[ HAS_SKETCH ] ) {\n\n        for ( var i = 0; i < MATH_PROPS.length; i++ )\n\n          context[ MATH_PROPS[i] ] = M[ MATH_PROPS[i] ];\n\n        extend( context, {\n\n          TWO_PI: M.PI * 2,\n          HALF_PI: M.PI / 2,\n          QUARTER_PI: M.PI / 4,\n\n          random: function( min, max ) {\n\n            if ( isArray( min ) )\n\n              return min[ ~~( M.random() * min.length ) ];\n\n            if ( !isNumber( max ) )\n\n              max = min || 1, min = 0;\n\n            return min + M.random() * ( max - min );\n          },\n\n          lerp: function( min, max, amount ) {\n\n            return min + amount * ( max - min );\n          },\n\n          map: function( num, minA, maxA, minB, maxB ) {\n\n            return ( num - minA ) / ( maxA - minA ) * ( maxB - minB ) + minB;\n          }\n        });\n\n        context[ HAS_SKETCH ] = true;\n      }\n    },\n\n    create: function( options ) {\n\n      options = extend( options || {}, defaults );\n\n      if ( options.globals ) Sketch.install( self );\n\n      element = options.element = options.element || doc.createElement( options.type === DOM ? 'div' : 'canvas' );\n\n      context = options.context = options.context || (function() {\n\n        switch( options.type ) {\n\n          case CANVAS:\n\n            return element.getContext( '2d', options );\n\n          case WEBGL:\n\n            return element.getContext( 'webgl', options ) || element.getContext( 'experimental-webgl', options );\n\n          case DOM:\n\n            return element.canvas = element;\n        }\n\n      })();\n\n      ( options.container || doc.body ).appendChild( element );\n\n      return Sketch.augment( context, options );\n    },\n\n    augment: function( context, options ) {\n\n      options = extend( options || {}, defaults );\n\n      options.element = context.canvas || context;\n      options.element.className += ' sketch';\n\n      extend( context, options, true );\n\n      return constructor( context );\n    }\n  };\n\n  /*\n  ----------------------------------------------------------------------\n\n    Shims\n\n  ----------------------------------------------------------------------\n  */\n\n  var vendors = [ 'ms', 'moz', 'webkit', 'o' ];\n  var scope = self;\n  var then = 0;\n\n  var a = 'AnimationFrame';\n  var b = 'request' + a;\n  var c = 'cancel' + a;\n\n  var rAF = scope[ b ];\n  var cAF = scope[ c ];\n\n  for ( var i = 0; i < vendors.length && !rAF; i++ ) {\n\n    rAF = scope[ vendors[ i ] + 'Request' + a ];\n    cAF = scope[ vendors[ i ] + 'Cancel' + a ];\n  }\n\n  scope[ b ] = rAF = rAF || function( callback ) {\n\n    var now = +new Date();\n    var dt = M.max( 0, 16 - ( now - then ) );\n    var id = setTimeout( function() {\n      callback( now + dt );\n    }, dt );\n\n    then = now + dt;\n    return id;\n  };\n\n  scope[ c ] = cAF = cAF || function( id ) {\n    clearTimeout( id );\n  };\n\n  /*\n  ----------------------------------------------------------------------\n\n    Output\n\n  ----------------------------------------------------------------------\n  */\n\n  return Sketch;\n\n}));\n","/*global navigator, window */\n\nvar VideoFlow = require('./videoFlow');\nmodule.exports = WebCamFlow;\n\n/**\n * A high level interface to capture optical flow from the web camera.\n * @param defaultVideoTag {DOMElement} optional reference to <video> tag\n *   where web camera output should be rendered. If parameter is not\n *   present a new invisible <video> tag is created.\n * @param zoneSize {int} optional size of a flow zone in pixels. 8 by default\n * @param cameraFacing {string} optional direction camera is facing (either\n * 'user' or 'environment') used to give preference to a particular mobile\n * camera. If matching camera is not found, any available one will be used.\n *\n * Usage example:\n *  var flow = new WebCamFlow();\n *\n *  // Every time when optical flow is calculated\n *  // call the passed in callback:\n *  flow.onCalculated(function (direction) {\n *      // direction is an object which describes current flow:\n *      // direction.u, direction.v {floats} general flow vector\n *      // direction.zones {Array} is a collection of flowZones.\n *      //  Each flow zone describes optical flow direction inside of it.\n *  });\n *  // Starts capturing the flow from webcamera:\n *  flow.startCapture();\n *  // once you are done capturing call\n *  flow.stopCapture();\n */\nfunction WebCamFlow(defaultVideoTag, zoneSize, cameraFacing, videoOptions) {\n    var videoTag,\n        isCapturing,\n        localStream,\n        calculatedCallbacks = [],\n        flowCalculatedCallback,\n        videoFlow,\n        onWebCamFail = function onWebCamFail(e) {\n            if(e.code === 1){\n                // window.alert('You have denied access to your camera. I cannot do anything.');\n            } else {\n                // window.alert('getUserMedia() is not supported in your browser.');\n            }\n        },\n        gotFlow = function(direction) {\n            calculatedCallbacks.forEach(function (callback) {\n                callback(direction);\n            });\n        },\n        initCapture = function() {\n        if (!videoFlow) {\n            videoTag = defaultVideoTag || window.document.createElement('video');\n            videoTag.setAttribute('autoplay', true);\n            videoFlow = new VideoFlow(videoTag, zoneSize);\n        }\n\n\n        \n\n        if (window.MediaStreamTrack.getSources) {\n            window.MediaStreamTrack.getSources(function(sourceInfos) {\n                for (var i = 0; i < sourceInfos.length; i++) {\n                    if (sourceInfos[i].kind === 'video'){\n                        selectedVideoSource = sourceInfos[i].id;\n                        // if camera facing requested direction is found, stop search\n                        if (sourceInfos[i].facing === cameraFacing) {\n                            break;\n                        }\n                    }\n                }\n\n                desiredDevice = videoOptions ? videoOptions : { optional: [{sourceId: selectedVideoSource}] };\n\n                navigator.getUserMedia({ video: desiredDevice }, function(stream) {\n                    isCapturing = true;\n                    localStream = stream;\n                    videoTag.srcObject = stream;\n                    if (stream) {\n                        videoFlow.startCapture(videoTag);\n                        videoFlow.onCalculated(gotFlow);\n                    }\n                }, onWebCamFail);\n            });\n        } else if(navigator.mediaDevices.enumerateDevices) {\n            navigator.mediaDevices.enumerateDevices().then(\n                function(sourceInfos){\n                    for (var i = 0; i < sourceInfos.length; i++) {\n                        if(sourceInfos[i].kind == \"videoinput\"){\n                            selectedVideoSource = sourceInfos[i].deviceId;\n                        }\n                    }\n                    \n                    desiredDevice = videoOptions ? videoOptions : { optional: [{sourceId: selectedVideoSource}] };\n\n                    navigator.getUserMedia({ video: desiredDevice }, function(stream) {\n                        isCapturing = true;\n                        localStream = stream;\n                        videoTag.srcObject = (stream);\n                        if (stream) {\n                            videoFlow.startCapture(videoTag);\n                            videoFlow.onCalculated(gotFlow);\n                        }\n                    }, onWebCamFail);\n                }\n            );\n        }\n\n\n\n    };\n\n    if (!navigator.getUserMedia) {\n        navigator.getUserMedia = navigator.getUserMedia ||\n                                 navigator.webkitGetUserMedia ||\n                                 navigator.mozGetUserMedia ||\n                                 navigator.msGetUserMedia;\n    }\n\n    // our public API\n    this.startCapture = function () {\n        if (!isCapturing) {\n            initCapture();\n        }\n    };\n    this.onCalculated = function (callback) {\n        calculatedCallbacks.push(callback);\n    };\n    this.stopCapture = function() {\n        isCapturing = false;\n        if (videoFlow) { videoFlow.stopCapture(); }\n        if (videoTag) { videoTag.pause(); }\n        if (localStream) { localStream.stop(); }\n    };\n}\n","import Sketch from './sketch';\nimport Stats from 'stats-js';\n\nimport WebCamFlow from './oflow/webcamFlow';\n\nlet sketch = Sketch.create({\n    eventTarget: document.body,\n    container: document.body,\n    retina: 'auto'\n});\n\nlet style = sketch.element.style;\nstyle.position = 'absolute';\nstyle.left = '0px';\nstyle.top = '0px';\nstyle.backgroundColor = '#000';\n\nlet ctx = sketch;\n\nlet stats;\nif (process.env.NODE_ENV !== 'production') {\n    stats = new Stats();\n    stats.setMode(1);\n    document.body.appendChild( stats.domElement );\n    sketch.stats = stats;\n}\n\nlet velocityIterations = 8;\nlet positionIterations = 3;\nlet world = null;\nlet particleSystem;\nlet positions;\nlet velocities;\nlet numParticles;\nlet webcamFlow;\n\nlet flow;\n\nsketch.setup = () => {\n    let gravity = new b2Vec2(0, 200.0);\n    world = window.world = new b2World(gravity); // ugh\n\n    var bd = new b2BodyDef();\n    bd.type = b2_staticBody;\n\n    let body = world.CreateBody(bd);\n\n    let b1 = new b2PolygonShape();\n    b1.SetAsBoxXYCenterAngle(0.5, 2, new b2Vec2(2.1, 0), 0);\n    body.CreateFixtureFromShape(b1, 5);\n\n    let b2 = new b2PolygonShape();\n    b2.SetAsBoxXYCenterAngle(0.5, 2, new b2Vec2(-2.1, 0), 0);\n    body.CreateFixtureFromShape(b2, 5);\n\n    let b3 = new b2PolygonShape();\n    b3.SetAsBoxXYCenterAngle(4, 0.5, new b2Vec2(0, 1.5), 0);\n    body.CreateFixtureFromShape(b3, 5);\n\n    let b4 = new b2PolygonShape();\n    b4.SetAsBoxXYCenterAngle(4, 0.5, new b2Vec2(0, -1.5), 0);\n    body.CreateFixtureFromShape(b4, 5);\n\n    // setup particle system\n    let psd = new b2ParticleSystemDef();\n    psd.radius = 0.045;\n    psd.dampingStrength = 0.1;\n    psd.surfaceTensionNormalStrength = 0.004;\n    psd.surfaceTensionPressureStrength = 0.004;\n\n    particleSystem = world.CreateParticleSystem(psd);\n    let box = new b2PolygonShape();\n    box.SetAsBoxXYCenterAngle(1.5, 0.7, new b2Vec2(0, 0.2), 0);\n\n    let particleGroupDef = new b2ParticleGroupDef();\n    particleGroupDef.shape = box;\n    particleGroupDef.flags = b2_tensileParticle;\n    let particleGroup = particleSystem.CreateParticleGroup(particleGroupDef);\n\n    positions = particleSystem.GetPositionBuffer();\n    velocities = particleSystem.GetVelocityBuffer();\n    numParticles = positions.length;\n\n    webcamFlow = new WebCamFlow(null, null, null, { width: { ideal: 480 }, height: { ideal: 320 } });\n    webcamFlow.startCapture();\n    webcamFlow.onCalculated(gotFlow);\n}\n\nfunction gotFlow(direction) {\n    flow = direction;\n}\n\n// https://stackoverflow.com/questions/849211/shortest-distance-between-a-point-and-a-line-segment\nfunction sqr(x) { return x * x }\nfunction dist2(v, w) { return sqr(v.x - w.x) + sqr(v.y - w.y) }\nfunction distToSegmentSquared(p, v, w) {\n  var l2 = dist2(v, w);\n  if (l2 == 0) return dist2(p, v);\n  var t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\n  t = Math.max(0, Math.min(1, t));\n  return dist2(p, { x: v.x + t * (w.x - v.x),\n                    y: v.y + t * (w.y - v.y) });\n}\nfunction distToSegment(p, v, w) { return Math.sqrt(distToSegmentSquared(p, v, w)); }\n\nsketch.update = () => {\n    if (stats) {\n        stats.end();\n        stats.begin();\n    }\n\n    let height = ctx.height;\n    let width = ctx.width;\n\n    let mouse = ctx.mouse;\n    let m1 = {\n        x: (mouse.ox - width / 2) / height * 2,\n        y: (mouse.oy - height / 2) / height * 2\n    };\n    let m2 = {\n        x: (mouse.x - width / 2) / height * 2,\n        y: (mouse.y - height / 2) / height * 2\n    };\n    let v = {\n        x: (mouse.dx) / height * 2,\n        y: (mouse.dy) / height * 2\n    };\n    // console.log(v);\n\n    for (let i = 0; i < numParticles; i += 2)\n    {\n        let pos = {\n            x: positions[i],\n            y: positions[i+1]\n        };\n        if (distToSegmentSquared(pos, m1, m2) < 0.1 * 0.1)\n        {\n            // console.log('hello');\n            velocities[i] += v.x * 300;\n            velocities[i+1] += v.y * 300;\n        }\n\n        if (flow) {\n            let fx = round(map(pos.x, -1.5, 1.5, flow.numX, 0));\n            let fy = round(map(pos.y, -1, 1, 0, flow.numY));\n            if (0 <= fx && fx < flow.numX && 0 <= fy && fy < flow.numY)\n            {\n                let index = (fy * flow.numX + fx) * 2;\n                let u = -flow.uvArray[index];\n                let v = flow.uvArray[index+1];\n                velocities[i] += u * 1;\n                velocities[i+1] += v * 1;\n            }\n        }\n    }\n\n    world.Step(1 / 60 / 60, velocityIterations, positionIterations);\n}\n\nsketch.draw = () => {\n    let dpr = window.devicePixelRatio || 1;\n    let height = ctx.height * dpr;\n    let width = ctx.width * dpr;\n\n    ctx.setTransform(height / 2, 1, 1, height / 2, width/2, height/2);\n\n    ctx.fillStyle = '#AAA';\n\n    for (let i = 0; i < numParticles; i += 2)\n    {\n        let x = positions[i];\n        let y = positions[i+1];\n        let vx = velocities[i];\n        let vy = velocities[i+1];\n        let v = sqrt(vx*vx + vy*vy);\n        v = map(v, 0, 200, 0, 1);\n\n        let r, g, b;\n        let a = 0.7;\n        if (flow)\n        {\n            let ix = floor(map(x, -1.5, 1.5, flow.width, 0));\n            ix = min(flow.width-1, max(0, ix));\n            let iy = floor(map(y, -1, 1, 0, flow.height));\n            iy = min(flow.height-1, max(0, iy));\n            let address = (flow.width * iy + ix) * 4;\n\n            r = flow.image[address];\n            g = flow.image[address+1];\n            b = flow.image[address+2];\n\n            let lum = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n            let m = max(10, lum) / lum;\n\n            let rgv = pow(v, 0.3);\n            let bv = pow(v, 0.5);\n\n            r = floor(min(255, r * m * rgv));\n            g = floor(min(255, g * m * rgv));\n            b = floor(min(255, b * m * bv));\n        }\n        else\n        {\n            r = floor(pow(v, 0.3) * 255);\n            g = r;\n            b = floor(pow(v, 0.5) * 255);\n        }\n\n        ctx.fillStyle = 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n\n        let rad = map(pow(v, 1), 0, 1, 0.001, 0.035);\n\n        ctx.beginPath();\n        ctx.arc(x, y, rad, 0, TWO_PI);\n        ctx.fill();\n    }\n\n    // if (flow) {\n    //     let index = 0;\n\n    //     let h = 2 / flow.numY;\n    //     let w = h;\n\n    //     for (let j = 0; j < flow.numY; j++)\n    //     {\n    //         for (let i = 0; i < flow.numX; i++)\n    //         {\n    //             let u = flow.uvArray[index++];\n    //             u = map(u, -flow.winStep, flow.winStep, 0, 1);\n    //             let v = flow.uvArray[index++];\n    //             v = map(v, -flow.winStep, flow.winStep, 0, 1);\n\n    //             let r = floor(u * 255);\n    //             let g = floor(v * 255);\n    //             let b = 0;\n\n    //             let x = map(i, 0, flow.numX, 1.5, -1.5);\n    //             let y = map(j, 0, flow.numY, -1.0, 1.0);\n\n    //             ctx.fillStyle = 'rgba(' + r + ', ' + g + ',' + b + ',' + 0.2 + ')';\n    //             ctx.fillRect(x, y, w, h);\n    //         }\n    //     }\n    // }\n}\n\nsketch.touchstart = (event) => {\n    event.preventDefault();\n}\n","!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){\"use strict\";var c=function(){var n=0,l=document.createElement(\"div\");function e(e){return l.appendChild(e.dom),e}function t(e){for(var t=0;t<l.children.length;t++)l.children[t].style.display=t===e?\"block\":\"none\";n=e}l.style.cssText=\"position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000\",l.addEventListener(\"click\",function(e){e.preventDefault(),t(++n%l.children.length)},!1);var i=(performance||Date).now(),a=i,o=0,f=e(new c.Panel(\"FPS\",\"#0ff\",\"#002\")),r=e(new c.Panel(\"MS\",\"#0f0\",\"#020\"));if(self.performance&&self.performance.memory)var d=e(new c.Panel(\"MB\",\"#f08\",\"#201\"));return t(0),{REVISION:16,dom:l,addPanel:e,showPanel:t,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(r.update(e-i,200),a+1e3<=e&&(f.update(1e3*o/(e-a),100),a=e,o=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:l,setMode:t}};return c.Panel=function(n,l,i){var a=1/0,o=0,f=Math.round,r=f(window.devicePixelRatio||1),d=80*r,e=48*r,c=3*r,p=2*r,u=3*r,s=15*r,m=74*r,h=30*r,y=document.createElement(\"canvas\");y.width=d,y.height=e,y.style.cssText=\"width:80px;height:48px\";var v=y.getContext(\"2d\");return v.font=\"bold \"+9*r+\"px Helvetica,Arial,sans-serif\",v.textBaseline=\"top\",v.fillStyle=i,v.fillRect(0,0,d,e),v.fillStyle=l,v.fillText(n,c,p),v.fillRect(u,s,m,h),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(u,s,m,h),{dom:y,update:function(e,t){a=Math.min(a,e),o=Math.max(o,e),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,d,s),v.fillStyle=l,v.fillText(f(e)+\" \"+n+\" (\"+f(a)+\"-\"+f(o)+\")\",c,p),v.drawImage(y,u+r,s,m-r,h,u,s,m-r,h),v.fillRect(u+m-r,s,r,h),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(u+m-r,s,r,f((1-e/t)*h))}}},c});\n","/*global window */\n\nvar FlowCalculator = require('./flowCalculator');\nmodule.exports = VideoFlow;\n\n/**\n * A high level interface to capture optical flow from the <video> tag.\n * The API is symmetrical to webcamFlow.js\n *\n * Usage example:\n *  var flow = new VideoFlow();\n *\n *  // Every time when optical flow is calculated\n *  // call the passed in callback:\n *  flow.onCalculated(function (direction) {\n *      // direction is an object which describes current flow:\n *      // direction.u, direction.v {floats} general flow vector\n *      // direction.zones {Array} is a collection of flowZones.\n *      //  Each flow zone describes optical flow direction inside of it.\n *  });\n *  // Starts capturing the flow from webcamera:\n *  flow.startCapture();\n *  // once you are done capturing call\n *  flow.stopCapture();\n */\nfunction VideoFlow(defaultVideoTag, zoneSize) {\n    var calculatedCallbacks = [],\n        canvas,\n        video = defaultVideoTag,\n        ctx,\n        width,\n        height,\n        oldImage,\n        loopId,\n        calculator = new FlowCalculator(zoneSize || 8),\n\n        requestAnimFrame = window.requestAnimationFrame       ||\n                           window.webkitRequestAnimationFrame ||\n                           window.mozRequestAnimationFrame    ||\n                           window.oRequestAnimationFrame      ||\n                           window.msRequestAnimationFrame     ||\n                           function( callback ) { window.setTimeout(callback, 1000 / 60); },\n        cancelAnimFrame =  window.cancelAnimationFrame ||\n                           window.mozCancelAnimationFrame,\n        isCapturing = false,\n\n        getCurrentPixels = function () {\n            width = video.videoWidth;\n            height = video.videoHeight;\n            canvas.width  = width;\n            canvas.height = height;\n\n            if (width && height) {\n                ctx.drawImage(video, 0, 0);\n                var imgd = ctx.getImageData(0, 0, width, height);\n                return imgd.data;\n            }\n        },\n        calculate = function () {\n            var newImage = getCurrentPixels();\n            // console.log(width + \":\" + height);\n            if (oldImage && newImage) {\n                var zones = calculator.calculate(oldImage, newImage, width, height);\n                calculatedCallbacks.forEach(function (callback) {\n                    callback(zones);\n                });\n            }\n            oldImage = newImage;\n        },\n\n        initView = function () {\n            width = video.videoWidth;\n            height = video.videoHeight;\n\n            if (!canvas) { canvas = window.document.createElement('canvas'); }\n            ctx = canvas.getContext('2d');\n        },\n        animloop = function () {\n            if (isCapturing) {\n                loopId = requestAnimFrame(animloop);\n                calculate();\n            }\n        };\n\n    if (!defaultVideoTag) {\n        var err = new Error();\n        err.message = \"Video tag is required\";\n        throw err;\n    }\n\n    this.startCapture = function () {\n        // todo: error?\n        isCapturing = true;\n        initView();\n        animloop();\n    };\n    this.stopCapture = function () {\n        cancelAnimFrame(loopId);\n        isCapturing = false;\n    };\n    this.onCalculated = function (callback) {\n        calculatedCallbacks.push(callback);\n    };\n    this.getWidth = function () { return width; };\n    this.getHeight = function () { return height; };\n}\n","/*jslint sloppy: true, vars: true, plusplus: true, white: true */\n\nvar FlowZone = require('./flowZone');\n\nmodule.exports = FlowCalculator;\n\n/**\n * The heart of the optical flow detection. Implements Lucas-Kande method:\n * http://en.wikipedia.org/wiki/Lucas%E2%80%93Kanade_method\n * Current implementation is not extremely tolerant to garbage collector.\n * This could be improved...\n */\nfunction FlowCalculator(step) {\n    this.step = step || 8;\n}\n\nFlowCalculator.prototype.calculate = function (oldImage, newImage, width, height) {\n    // var zones = [];\n    var step = this.step;\n    var winStep = step * 2 + 1;\n    \n    var A2, A1B2, B1, C1, C2;\n    var u, v, uu, vv;\n    uu = vv = 0;\n    var wMax = width - step - 1;\n    var hMax = height - step - 1;\n    var globalY, globalX, localY, localX;\n    \n    this.numX = ceil((wMax - step - 1) / winStep);\n    this.numY = ceil((hMax - step - 1) / winStep);\n    var numElements = this.numX * this.numY * 2;\n    this.uvArray = (this.uvArray && this.uvArray.length === numElements) ? this.uvArray : new Float32Array(numElements);\n    var index = 0;\n\n    for (globalY = step + 1; globalY < hMax; globalY += winStep) {\n        for (globalX = step + 1; globalX < wMax; globalX += winStep) {\n            A2 = A1B2 = B1 = C1 = C2 = 0;\n\n            for (localY = -step; localY <= step; localY++) {\n                for (localX = -step; localX <= step; localX++) {\n                    var address = (globalY + localY) * width + globalX + localX;\n\n                    var gradX = (newImage[(address - 1) * 4]) - (newImage[(address + 1) * 4]);\n                    var gradY = (newImage[(address - width) * 4]) - (newImage[(address + width) * 4]);\n                    var gradT = (oldImage[address * 4]) - (newImage[address * 4]);\n\n                    A2 += gradX * gradX;\n                    A1B2 += gradX * gradY;\n                    B1 += gradY * gradY;\n                    C2 += gradX * gradT;\n                    C1 += gradY * gradT;\n                }\n            }\n\n            var delta = (A1B2 * A1B2 - A2 * B1);\n\n            if (delta !== 0) {\n                /* system is not singular - solving by Kramer method */\n                var Idelta = step / delta;\n                var deltaX = -(C1 * A1B2 - C2 * B1);\n                var deltaY = -(A1B2 * C2 - A2 * C1);\n\n                u = deltaX * Idelta;\n                v = deltaY * Idelta;\n            } else {\n                /* singular system - find optical flow in gradient direction */\n                var norm = (A1B2 + A2) * (A1B2 + A2) + (B1 + A1B2) * (B1 + A1B2);\n                if (norm !== 0) {\n                    var IGradNorm = step / norm;\n                    var temp = -(C1 + C2) * IGradNorm;\n\n                    u = (A1B2 + A2) * temp;\n                    v = (B1 + A1B2) * temp;\n                } else {\n                    u = v = 0;\n                }\n            }\n\n            u = max(-winStep, min(winStep, u));\n            v = max(-winStep, min(winStep, v));\n\n            // if (-winStep < u && u < winStep &&\n                // -winStep < v && v < winStep) {\n                uu += u;\n                vv += v;\n                // zones.push(new FlowZone(globalX, globalY, u, v));\n                \n            // }\n            this.uvArray[index++] = u;\n            this.uvArray[index++] = v;\n        }\n    }\n\n    return {\n        // zones : zones,\n        uvArray: this.uvArray,\n        numX: this.numX,\n        numY: this.numY,\n        winStep: winStep,\n        u : uu / (numElements / 2),\n        v : vv / (numElements / 2),\n        image: newImage,\n        width: width,\n        height: height,\n    };\n};\n","module.exports = FlowZone;\n\nfunction FlowZone(x, y, u, v) {\n    this.x = x;\n    this.y = y;\n    this.u = u;\n    this.v = v;\n}\n"],"sourceRoot":""}